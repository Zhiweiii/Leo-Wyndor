---
title: "p3_regression"
author: "Zhiwei Li (#8293171589)"
date: "12/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Load Data
```{r}
df <- read.csv("Advertising.csv")
a <- seq(1, 100, by=1)
b <- seq(101, 200, by=1)
train <- df[a,]
valid <- df[b,]
```

# MLR
```{r}
model <- lm(train$Sales~train$TV+train$Radio)
summary(model)
b0 = 3.14699
b1 = 0.04585
b2 = 0.18412

ev = replicate(100, 0)
ei = replicate(100, 0)
for (i in 1:100)
{
  ev[i] = valid$Sales[i]-b0-b1*valid$TV[i]-b2*valid$Radio[i]
}
for (i in 1:100){
  ei[i] = train$Sales[i]-b0-b1*train$TV[i]-b2*train$Radio[i]
}

print(toString(round(ei,3)))
```
```{r}
# Validation Input w
x1_hat = 184.83394807261155
x2_hat = 15.166051927388452

w = replicate(100, 0)
for (i in 1:100){
  w[i] = b0+b1*x1_hat+b2*x2_hat+ev[i]
}
print(toString(w))
```

```{r}
# validation out put profit
profit = c(59.89127, 68.38054199999999, 56.80114, 66.554793, 68.190672, 70.803381, 69.88632, 71.300802, 71.678181, 67.212276, 62.412888, 68.965515, 67.427151, 65.291934, 64.99417199999999, 65.938425, 67.355322, 72.0, 67.828911, 66.09479999999999, 70.06196700000001, 64.228878, 60.464166, 67.35696899999999, 67.492077, 71.088822, 51.73555999999999, 72.0, 72.0, 72.0, 27.718815, 56.368210000000005, 57.869029999999995, 67.86348, 63.804339, 59.994075, 61.23771, 66.590391, 66.380256, 70.219431, 71.01474, 69.20405099999999, 69.43290300000001, 71.464848, 70.59379200000001, 68.35328100000001, 60.343047, 72.0, 63.014022, 67.701657, 59.688235, 71.317656, 67.551162, 69.310023, 67.11434399999999, 60.429699, 66.757425, 66.777972, 56.182685, 68.222271, 67.275939, 66.138507, 66.58889400000001, 68.984757, 69.260478, 58.945885000000004, 57.616915000000006, 63.083418, 66.43706399999999, 56.400915, 69.716154, 67.12973099999999, 66.802614, 65.815854, 59.71981, 72.0, 67.55233799999999, 65.181612, 49.784195000000004, 67.29915, 66.32456400000001, 61.363611, 72.0, 72.0, 63.925572, 72.0, 68.35284899999999, 67.56249299999999, 57.47321, 68.64528899999999, 62.065809, 71.15051700000001, 70.87049400000001, 70.45857000000001, 69.445779, 72.0, 71.237256, 66.717732, 72.0, 61.325379)

c1 = 0.1
c2 = 0.5

fix = -c1*x1_hat-c2*x2_hat
MVSAE = fix + profit
m = mean(MVSAE)
s = sd(MVSAE)
n = 100
error <- qnorm(0.975)*s/sqrt(n)

left <- m - error
right <- m + error
left
right
s
```

# Outlier Detection
```{r}
# Validation set
which.min(ev)
# ev[31]
valid <- valid[-which.min(ev),]
dim(valid)

# training set
which.min(ei)
ei[which.min(ei)]
train <- train[-which.min(ei),]
dim(train)

which.min(ei)
ei[which.min(ei)]
train <- train[-which.min(ei),]
dim(train)

which.min(ei)
ei[which.min(ei)]
train <- train[-which.min(ei),]
dim(train)

ei[6]
```

# New Dataset (without outlier)
```{r}
new_df = rbind(train,valid)  
a <- seq(1, 98, by=1)
b <- seq(99, 196, by=1)
train1 <- new_df[a,]
valid1 <- new_df[b,]

# train1 
# valid1
```

# Regression without outlier
```{r}
model1 <- lm(train1$Sales~train1$TV+train1$Radio)
summary(model1)
```

```{r}
b0 = 3.157054
b1 = 0.044285
b2 = 0.194257

ev = replicate(98, 0)
ei = replicate(98, 0)
for (i in 1:98)
{
  ev[i] = valid1$Sales[i]-b0-b1*valid1$TV[i]-b2*valid1$Radio[i]
}
for (i in 1:98){
  ei[i] = train1$Sales[i]-b0-b1*train1$TV[i]-b2*train1$Radio[i]
}
print(toString(ei))
```


```{r}
# Validation Input w
x1_hat = 182.33274411223428
x2_hat = 17.66725588776572

w = replicate(98, 0)
for (i in 1:98){
  w[i] = b0+b1*x1_hat+b2*x2_hat+ev[i]
}
print(toString(w))
```

```{r}
# validation out put profit
profit = c(69.3869718, 59.679705, 67.63266540000001, 68.9846748, 70.75850220000001, 70.3879251, 72.0, 72.0, 68.3120742, 63.9423999, 69.6634296, 68.5024842, 66.3682905, 64.6568373, 65.94538560000001, 68.29273979999999, 72.0, 68.01565769999999, 66.4180581, 70.6291068, 64.3759764, 62.161610700000004, 67.601454, 68.3060553, 71.8581273, 51.022867, 72.0, 72.0, 72.0, 59.494332, 57.754046499999994, 68.5954236, 63.522470999999996, 59.187746, 60.8906241, 67.71528570000001, 66.5132472, 70.4712447, 71.5611171, 69.7556742, 70.1772564, 72.0, 71.3141193, 69.6729597, 61.9670673, 72.0, 62.6856198, 67.8456708, 61.4268657, 72.0, 68.4890688, 69.6257109, 68.073144, 60.814932, 66.5941581, 68.1604998, 55.6018795, 68.9997912, 68.25413850000001, 66.1709058, 67.641744, 69.3520158, 70.0824414, 61.0838622, 57.049145, 64.61495790000001, 67.44941850000001, 59.28622, 70.3168875, 67.9852197, 67.002126, 67.109325, 61.491407699999996, 72.0, 68.5189149, 66.4622463, 53.0307155, 68.4912831, 67.6994835, 62.944000200000005, 72.0, 72.0, 65.1881598, 72.0, 69.6626895, 68.3056629, 60.122734200000004, 69.0838635, 61.7201205, 71.8953018, 71.54531399999999, 70.6831851, 69.78474, 72.0, 72.0, 67.98467579999999, 72.0, 62.872305)

c1 = 0.1
c2 = 0.5

fix = -c1*x1_hat-c2*x2_hat
MVSAE = fix + profit
m = mean(MVSAE)
s = sd(MVSAE)
n = 98
error <- qnorm(0.975)*s/sqrt(n)

left <- m - error
right <- m + error
left
right
s
```




# Ridge regression
```{r}
library(glmnet)
# new_df
```

```{r}
model <- glmnet(train1[c("TV", "Radio")], unlist(train1["Sales"]), alpha = 0)
cv_model <- cv.glmnet(as.matrix(train1[c("TV", "Radio")]), unlist(train1["Sales"]), alpha = 0)
best_lambda <- cv_model$lambda.min
best_lambda
best_model <- glmnet(train1[c("TV", "Radio")], unlist(train1["Sales"]), alpha = 0, lambda = best_lambda)
coef(best_model)
```



```{r}
b0 = 3.90326244
b1 = 0.04129924
b2 = 0.18206018
ev = replicate(98, 0)
ei = replicate(98, 0)

for (i in 1:98)
{
  ev[i] = valid1$Sales[i]-b0-b1*valid1$TV[i]-b2*valid1$Radio[i]
}
for (i in 1:98){
  ei[i] = train1$Sales[i]-b0-b1*train1$TV[i]-b2*train1$Radio[i]
}
print(toString(ei))
```

```{r}
x1_hat = 185.04121173103846
x2_hat = 14.958788268961541

w = replicate(98, 0)
for (i in 1:98){
  w[i] = b0+b1*x1_hat+b2*x2_hat+ev[i]
}
print(toString(w))
```

```{r}
# validation out put profit
profit = c(69.94674548399999, 58.77303116, 66.521696418, 68.949953868, 70.26811065, 67.590954354, 69.832175244, 69.15485094600001, 68.16064908, 62.84159769, 69.79544385, 67.216373574, 65.576102058, 63.646332318, 64.475345622, 66.63943894799999, 72.0, 67.068377964, 63.753878886, 69.451996986, 61.91498844, 60.832460718, 66.54672727799999, 68.120225112, 69.64757173800001, 47.80593012, 71.55978615000001, 72.0, 70.257912702, 57.92464064, 53.832552930000006, 68.36661634800001, 61.841988582, 57.06939673, 58.53926767, 67.800959724, 64.422705348, 70.31036916, 69.417221466, 69.362603814, 69.943742106, 70.22345270400001, 69.293950638, 67.575790152, 60.96142278, 72.0, 61.077194172, 65.76669727800001, 61.026383784000004, 70.316842638, 67.68818724, 69.18933641999999, 67.103982084, 56.421180629999995, 65.603533896, 66.126470136, 52.32119674, 67.429331634, 67.03815882, 64.825085358, 66.568185072, 68.739662202, 68.246716572, 59.80892353, 53.90370967, 63.234195989999996, 66.818953662, 58.471246289999996, 67.76580303, 66.800035068, 64.489759128, 65.454125412, 60.184516529999996, 72.0, 68.425537338, 64.848783138, 51.59611488, 66.917115462, 65.773930938, 61.675356558000004, 71.120102352, 72.0, 64.817496456, 72.0, 67.56567222, 67.644147504, 59.61620978, 66.270711396, 60.15440316, 69.54335560199999, 68.42600229600001, 70.290660918, 69.004867386, 71.14262239199999, 69.848933424, 66.487007832, 72.0, 61.842569838)

c1 = 0.1
c2 = 0.5

fix = -c1*x1_hat-c2*x2_hat
MVSAE = fix + profit
m = mean(MVSAE)
s = sd(MVSAE)
n = 98
error <- qnorm(0.975)*s/sqrt(n)

left <- m - error
right <- m + error
left
right
s
```



# Lasso Regression (potential zero coeff)
```{r}
cv_model <- cv.glmnet(as.matrix(train1[c("TV", "Radio")]), unlist(train1["Sales"]), alpha = 1)
best_lambda <- cv_model$lambda.min
best_lambda
```
```{r}
best_model <- glmnet(as.matrix(train1[c("TV", "Radio")]), unlist(train1["Sales"]), alpha = 1, lambda = best_lambda)
coef(best_model)
```
```{r}
b0 = 3.2320166
b1 = 0.0440267
b2 = 0.1927759

ev = replicate(98, 0)
ei = replicate(98, 0)
for (i in 1:98)
{
  ev[i] = valid1$Sales[i]-b0-b1*valid1$TV[i]-b2*valid1$Radio[i]
}
for (i in 1:98){
  ei[i] = train1$Sales[i]-b0-b1*train1$TV[i]-b2*train1$Radio[i]
}
print(toString(ei))
```

```{r}
x1_hat = 182.3667953172185
x2_hat = 17.633204682781496

w = replicate(98, 0)
for (i in 1:98){
  w[i] = b0+b1*x1_hat+b2*x2_hat+ev[i]
}
print(toString(w))
```

```{r}
# validation out put profit
profit = c(69.54295812000001, 59.7247358, 67.61970804, 69.08667534, 70.8365442, 70.22118807, 72.0, 72.0, 68.3945226, 63.918821550000004, 69.7845825, 68.47207512, 66.38725568999999, 64.69039509, 65.92411026, 68.22915924, 72.0, 68.04203457, 66.26919813, 70.62269478, 64.2519783, 62.11086639, 67.61559654, 68.39242761, 71.74314369, 50.929371599999996, 72.0, 72.0, 72.0, 59.4666707, 57.574681649999995, 68.67961134000001, 63.48759036, 59.2065409, 60.84876441, 67.82080137, 66.42666353999999, 70.57459875, 71.45854503, 69.82807932, 70.26065358, 72.0, 71.21943969, 69.55513461000001, 61.95057105, 72.0, 62.659145159999994, 67.75996014, 61.47115617, 72.0, 68.5107321, 69.69986445, 68.07743802, 60.63466554, 66.62521893, 68.04737028, 55.49860995, 68.94861642000001, 68.23324665, 66.16139903999999, 67.63317306, 69.40723956, 70.00359036, 61.04569764, 56.9590666, 64.56332655, 67.48620801, 59.340248700000004, 70.17218895, 67.97056989000001, 66.87163853999999, 67.03637976, 61.44386685, 72.0, 68.61060189, 66.39380618999999, 53.01346315, 68.42905371, 67.59739959000001, 62.902323839999994, 72.0, 72.0, 65.24448588, 72.0, 69.54513315, 68.34628316999999, 60.17113164, 68.91713222999999, 61.69836285, 71.76680856, 71.34187398, 70.76407119, 69.82393818, 72.0, 72.0, 67.92816995999999, 72.0, 62.855385840000004)

c1 = 0.1
c2 = 0.5

fix = -c1*x1_hat-c2*x2_hat
MVSAE = fix + profit
m = mean(MVSAE)
s = sd(MVSAE)
n = 98
error <- qnorm(0.975)*s/sqrt(n)

left <- m - error
right <- m + error
left
right
s
```

